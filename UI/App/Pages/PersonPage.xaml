<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="GT4.UI.Pages.PersonPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:components="clr-namespace:GT4.UI.Components"
    xmlns:items="clr-namespace:GT4.UI.Items"
    xmlns:resources="clr-namespace:GT4.UI.Resources;assembly=GT4.UI.Resources"
    x:Name="Root"
    Title="{Binding ShortName, Source={x:Reference Root}}">

  <ContentPage.Resources>
    <ResourceDictionary>

      <OnIdiom
          x:Key="PhotoHeight"
          x:TypeArguments="x:Double"
          Desktop="500"
          Phone="250"
          Tablet="400" />

      <OnIdiom
          x:Key="PhotoWidth"
          x:TypeArguments="x:Double"
          Desktop="375"
          Phone="187.5"
          Tablet="300" />

      <Style x:Key="PhotoStyle" TargetType="Image">
        <Setter Property="Aspect" Value="AspectFit" />
        <Setter Property="HeightRequest" Value="{StaticResource PhotoHeight}" />
        <Setter Property="WidthRequest" Value="{StaticResource PhotoWidth}" />
        <Setter Property="HorizontalOptions" Value="Center" />
        <Setter Property="VerticalOptions" Value="Center" />
      </Style>

    </ResourceDictionary>
  </ContentPage.Resources>

  <ContentPage.ToolbarItems>
    <ToolbarItem
        Command="{Binding PageCommand, Source={x:Reference Root}}"
        CommandParameter="RemovePerson"
        Order="Secondary"
        Text="{Binding RemovePersonToolbarItemName, Source={x:Reference Root}}" />
    <ToolbarItem
        Command="{Binding PageCommand, Source={x:Reference Root}}"
        CommandParameter="EditPerson"
        Order="Secondary"
        Text="{Binding EditPersonToolbarItemName, Source={x:Reference Root}}" />
    <ToolbarItem
        Command="{Binding PageCommand, Source={x:Reference Root}}"
        CommandParameter="Refresh"
        Order="Secondary"
        Text="{x:Static resources:UIStrings.MenuItemNameRefresh}" />
  </ContentPage.ToolbarItems>

  <components:PageLayout>
    <components:PageLayout.Header>
      <Grid
          ColumnDefinitions="Auto, *"
          RowDefinitions="Auto, Auto, Auto, Auto, Auto">

        <Label
            Grid.Row="0"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Style="{StaticResource GroupTitle}"
            Text="{Binding CommonName, Source={x:Reference Root}}" />

        <Label
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            IsVisible="{Binding ShowFullName, Source={x:Reference Root}}"
            Style="{StaticResource CardSubtitle}"
            Text="{Binding FullName, Source={x:Reference Root}}" />

        <Label
            Grid.Row="2"
            Grid.Column="0"
            Style="{StaticResource FieldName}"
            Text="{x:Static resources:UIStrings.FieldDateOfBirth}" />

        <Label
            Grid.Row="2"
            Grid.Column="1"
            Style="{StaticResource FieldValue}"
            Text="{Binding BirthDate, Source={x:Reference Root}}" />

        <Label
            Grid.Row="3"
            Grid.Column="0"
            IsVisible="{Binding ShowDeathDate, Source={x:Reference Root}}"
            Style="{StaticResource FieldName}"
            Text="{x:Static resources:UIStrings.FieldDateOfDeath}" />

        <Label
            Grid.Row="3"
            Grid.Column="1"
            IsVisible="{Binding ShowDeathDate, Source={x:Reference Root}}"
            Style="{StaticResource FieldValue}"
            Text="{Binding DeathDate, Source={x:Reference Root}}" />

        <Label
            Grid.Row="4"
            Grid.Column="0"
            Style="{StaticResource FieldName}"
            Text="{x:Static resources:UIStrings.FieldAge}" />

        <Label
            Grid.Row="4"
            Grid.Column="1"
            Style="{StaticResource FieldValue}"
            Text="{Binding Age, Source={x:Reference Root}}" />
      </Grid>
    </components:PageLayout.Header>

    <components:PageLayout.Body>
      <ScrollView>
        <FlexLayout
            AlignContent="Center"
            AlignItems="Start"
            Direction="Row"
            JustifyContent="SpaceBetween"
            VerticalOptions="Start"
            Wrap="Wrap">

          <Image
              Margin="{Thickness Right={StaticResource PageContentSpacing}}"
              FlexLayout.Grow="0.7"
              FlexLayout.Order="1"
              Source="{Binding Photo, Source={x:Reference Root}}"
              Style="{StaticResource PhotoStyle}"
              VerticalOptions="Start" />

          <CollectionView
              FlexLayout.Basis="60%"
              FlexLayout.Grow="1"
              FlexLayout.Order="2"
              ItemsSource="{Binding Relatives, Source={x:Reference Root}}"
              SelectionMode="Single"
              VerticalScrollBarVisibility="Always">
            <CollectionView.ItemsLayout>
              <LinearItemsLayout
                  ItemSpacing="{StaticResource PageContentSpacing}"
                  Orientation="Vertical" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
              <DataTemplate x:DataType="items:RelativeInfoItem">
                <Grid
                    ColumnDefinitions="Auto, *"
                    RowDefinitions="Auto, Auto"
                    Style="{StaticResource HoverItem}">
                  <Grid.GestureRecognizers>
                    <TapGestureRecognizer
                        Command="{Binding Path=PageCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                        CommandParameter="{Binding .}" />
                  </Grid.GestureRecognizers>

                  <Label
                      Grid.Row="0"
                      Grid.Column="0"
                      Style="{StaticResource FieldValue}"
                      Text="{Binding RelationTypeName}"
                      VerticalOptions="Start" />

                  <Label
                      Grid.Row="0"
                      Grid.Column="1"
                      IsVisible="{Binding ShowDate}"
                      Style="{StaticResource FieldValue}"
                      Text="{Binding Date}"
                      VerticalOptions="Start" />

                  <components:PersonInfoView
                      Grid.Row="1"
                      Grid.Column="0"
                      Grid.ColumnSpan="2"
                      DatesLabelStyle="{StaticResource FieldValue}"
                      NameLabelStyle="{StaticResource FieldName}"
                      Person="{Binding Info}" />

                </Grid>
              </DataTemplate>
            </CollectionView.ItemTemplate>
          </CollectionView>

        </FlexLayout>
      </ScrollView>
    </components:PageLayout.Body>

  </components:PageLayout>
</ContentPage>
