<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2021/maui/toolkit"
             x:Class="GT4.UI.App.Pages.FamilyPage"
             xmlns:items="clr-namespace:GT4.UI.App.Items"
             xmlns:resources="clr-namespace:GT4.UI.Resources;assembly=GT4.UI.Resources"
             Title="{Binding FamilyName.Value}">
  <ScrollView>
    <VerticalStackLayout Padding="20" Spacing="10">
      
      <Label 
          Text="{x:Static resources:UIStrings.WndHintFamilyPage}"
          VerticalOptions="Center" 
          HorizontalOptions="Center" />

      <CollectionView 
          ItemsSource="{Binding Members}" 
          SelectionMode="Single" 
          SelectionChanged="OnMemberSelected">

        <CollectionView.ItemsLayout>
          <LinearItemsLayout 
              Orientation="Vertical" 
              ItemSpacing="3" />
        </CollectionView.ItemsLayout>

        <CollectionView.ItemTemplate>
          <DataTemplate x:DataType="items:FamilyMemberInfoItem">
            <Grid
                Padding="20" 
                VerticalOptions="Center"
                RowDefinitions="Auto, Auto"
                ColumnDefinitions="100, 30, *, Auto"
                ColumnSpacing="10"
                RowSpacing="10">

              <Image 
                  Grid.Column="0"
                  Grid.Row="0"
                  Grid.RowSpan="2"
                  Source="{Binding Icon}"  
                  VerticalOptions="Start"
                  Aspect="AspectFit"/>

              <Label 
                  Grid.Column="1"
                  Grid.Row="0"
                  Grid.ColumnSpan="2"
                  Text="{Binding CommonName}" 
                  FontSize="Medium"
                  FontAttributes="Bold"
                  LineBreakMode="TailTruncation"
                  HorizontalOptions="Fill"/>

              <VerticalStackLayout
                  Grid.Column="2"
                  Grid.Row="1"
                  IsVisible="{Binding IsHandlesVisible}">

                <Label 
                    Text="{Binding DateOfBirth}" 
                    FontSize="Small"
                    LineBreakMode="TailTruncation"
                    HorizontalOptions="Fill"/>

                <Label 
                    Text="{Binding DateOfDeath}" 
                    FontSize="Small"
                    LineBreakMode="TailTruncation"
                    HorizontalOptions="Fill"
                    IsVisible="{Binding ShowDateOfDeath}"/>

                <Label 
                    Text="{Binding Age}" 
                    FontSize="Small"
                    LineBreakMode="TailTruncation"
                    HorizontalOptions="Fill"/>

              </VerticalStackLayout>

              <VerticalStackLayout
                  Grid.Column="3"
                  Grid.Row="0"
                  Grid.RowSpan="2"
                  Spacing="10"
                  IsVisible="{Binding IsHandlesVisible}">

                <Button 
                    Text="🖋️"   
                    Clicked="OnEditPersonSelected"
                    WidthRequest="32"
                    HeightRequest="32"
                    VerticalOptions="Start"/>

                <Button 
                    Text="❌"  
                    Clicked="OnDeletePersonSelected"
                    WidthRequest="32"
                    HeightRequest="32"
                    VerticalOptions="Start"/>

              </VerticalStackLayout>

            </Grid>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>

    </VerticalStackLayout>
  </ScrollView>
</ContentPage>